function modalDialogLink(n,t,i){var r,f;if(jQuery(".qtip.ui-tooltip-help").qtip("hide"),r=jQuery(n),r.attr("disabled")=="disabled")return!1;r.attr("disabled",!0);var e=Math.floor(Math.random()*1e7),o="SitkajQueryModalDialogUniqueID"+e,s="SitkajQueryModalDialogContentUniqueID"+e,u;return u=typeof i=="function"?i():i,f={type:"GET",url:n.href},u!=null&&(f={type:"POST",url:n.href,data:JSON.stringify(u),contentType:"application/json"}),SitkaAjax.ajax(f,function(n){createBootstrapDialogForm(r,o,s,t,n);r.attr("disabled",!1)},function(){r.attr("disabled",!1)}),!1}function findBootstrapDialogForm(n,t){var i;if(Sitka.Methods.isUndefinedNullOrEmpty(n)||(i=jQuery("#"+n,t)),Sitka.Methods.isUndefinedNullOrEmpty(i)&&(i=jQuery("form",t)),i.length>1)throw new Error("Found more than 1 form to post!  Cannot proceed.");return i}function createBootstrapDialogForm(n,t,i,r,u){var c=n.attr("data-dialog-title"),o=parseInt(n.attr("data-dialog-width")),e;o=o==0?"auto":o+"px";var s=n.attr("data-save-button-id"),l=n.attr("data-save-button-text"),a=n.attr("data-cancel-button-id"),v=n.attr("data-cancel-button-text"),h=n.attr("data-optional-dialog-form-id"),y=n.attr("data-skip-ajax").toLowerCase()==="true"?!0:!1,f=jQuery(getModalDialogFromHtmlTemplate(t,c,u,o,l,s,v,a));f.modal({backdrop:"static"});f.draggable({handle:".modal-header"});e=jQuery("#"+s);e.on("click",function(){var t,n;return(e.attr("disabled",!0),t=tinymce.activeEditor.id,jQuery("#"+t).val(tinymce.activeEditor.getContent()),n=findBootstrapDialogForm(h,f),!n.valid())?(e.attr("disabled",!1),!1):(n.submit(),!0)});f.on("hide.bs.modal",function(n){n.target.id==t&&jQuery("*",f).qtip("hide")});f.on("hidden.bs.modal",function(){tinymce.remove("#"+t+" textarea");jQuery("#"+t).remove()});wireUpModalDialogForm(f,r,h,y,e)}function wireUpModalDialogForm(n,t,i,r,u){if(jQuery.validator.unobtrusive.parse(n),convertJQueryValidationErrorsToQtip(),Sitka.Methods.isUndefinedNullOrEmpty(r)&&(r=!1),Sitka.Methods.isUndefinedNullOrEmpty(t)||t(),jQuery(".sitkaDatePicker").datepicker(),!r){var f=findBootstrapDialogForm(i,n);f.ajaxForm({url:this.action,type:this.method,beforeSubmit:function(){jQuery(".progress-bar").html("Saving");jQuery(".progress").show();jQuery(u).attr("disabled",!0)},success:function(f,e,o){SitkaAjax.handleLoginRedirect(f,e,o,function(){jQuery(".progress").hide();jQuery(u).attr("disabled",!1);Sitka.Methods.isUndefinedNullOrEmpty(f)||Sitka.Methods.isUndefinedNullOrEmpty(f.Success)||!f.Success?(n.find(".modal-body").html(f),wireUpModalDialogForm(n,t,i,r,u)):(n.modal("hide"),Sitka.Methods.isUndefinedNullOrEmpty(f.RedirectUrl)?window.location.reload():window.location.href=f.RedirectUrl)})},error:function(t,i){jQuery(".progress").hide();jQuery(u).attr("disabled",!1);n.modal("hide");SitkaAjax.errorHandler(t,i)}})}}function getModalDialogFromHtmlTemplate(n,t,i,r,u,f,e,o){var s=i.indexOf("requiredFieldIcon")!==-1,h=s?'<span><sup><span class="glyphicon glyphicon-flash" style="color: #800020; font-size: 8px; "><\/span><\/sup> Required Field<\/span>':"";return"<div class='modal firma-modal' id='"+n+"' tabindex='-1'><div class='modal-dialog firma-modal-dialog' style = 'width:90%; max-width: "+r+"'><div class='modal-content'><div class='modal-header'><button type='button' class='modal-close-button btn btn-xs btn-firma' data-dismiss='modal'><span>&times;<\/span><\/button><span class='modal-title'>"+t+"<\/span><\/div><div class='modal-body'>"+i+"<\/div><div class='modal-footer'>"+h+"<div class='modal-footer-buttons'><button type='button' id='"+f+"' class='btn btn-xs btn-firma'>"+u+"<\/button><button type='button' id='"+o+"' class='btn btn-xs btn-firma' data-dismiss='modal'>"+e+"<\/button><\/div><\/div><div class='progress' style='display:none'><div class='progress-bar progress-bar-info progress-bar-striped active' role='progressbar' style='width:100%'>Saving<\/div><\/div><\/div><\/div><\/div>"}