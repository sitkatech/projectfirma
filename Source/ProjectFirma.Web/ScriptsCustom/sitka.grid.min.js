function htmlstring(n,t,i){var r=jQuery("<div>"+n+"<\/div>").text().toLowerCase(),u=jQuery("<div>"+t+"<\/div>").text().toLowerCase();return i=="asc"?r.localeCompare(u):u.localeCompare(r)}function getCheckboxCellValue(n){var t=jQuery(jQuery(n).find("[type='checkbox']")[0]).attr("selected"),i=2;return t!="undefined"&&(i=t?1:0),i}function htmlcheckbox(n,t,i){var r=getCheckboxCellValue(n),u=getCheckboxCellValue(t),f=r>=u;return i=="asc"?r>u:u>r}function stripNonNumeric(n){var r,i,t;for(n+="",r=/^\d|\.|-$/,i="",t=0;t<n.length;t++)r.test(n.charAt(t))&&(n.charAt(t)=="."&&i.indexOf(".")!=-1||n.charAt(t)=="-"&&i.length!=0||(i+=n.charAt(t)));return i}function fmtint(n,t,i){n=stripNonNumeric(n);t=stripNonNumeric(t);var r=parseFloat(n),r=isNaN(r)?-99999999999999:r,u=parseFloat(t),u=isNaN(u)?-99999999999999:u;return i=="asc"?r-u:u-r}function htmlinteger(n,t,i){var u=jQuery("<div>"+n+"<\/div>").text(),f=jQuery("<div>"+t+"<\/div>").text(),r=parseInt(u)>parseInt(f);return i=="asc"?r?1:-1:r?-1:1}var sitkaGridLocallyDefinedMultiSelectFilter;Array.indexOf||(Array.prototype.indexOf=function(n){for(var t=0;t<this.length;t++)if(this[t]==n)return t;return-1});dhx.Grid.prototype._in_header_formatted_numeric_filter_box=function(n,t){n.innerHTML='<input type="text" style="width:90%; font-size:8pt; font-family:Tahoma; -moz-user-select:text; ">';n.onclick=n.onmousedown=function(n){return(n||event).cancelBubble=!0};n.onselectstart=function(){return event.cancelBubble=!0};this.makeFilter(n.firstChild,t)};dhx.Grid.prototype._in_header_date_range_filter=function(n,t){var e=this,f=this.SitkaGridContainer.grid;n.innerHTML="<div style='width:100%; margin:0 auto; text-align: left;'>From: <input type='text' id='datefrom' style='width:60px;font-size:8pt;-moz-user-select:text; color:#000'><br />To: <input type='text' id='dateto' style='width:60px;font-size:8pt;-moz-user-select:text;color:#000;margin-left:16px'><\/div>";n.onclick=n.onmousedown=function(n){return(n||event).cancelBubble=!0};n.onselectstart=function(){return event.cancelBubble=!0};var i=this.getChildElement(n.firstChild,"datefrom"),r=this.getChildElement(n.firstChild,"dateto"),u=new dhtmlXCalendarObject([i,r]);u.setDateFormat("%m/%d/%Y");u.attachEvent("onClick",function(){f.filterByAll()});this.makeFilter(i,t);this.makeFilter(r,t);i._filter=function(){var n=this.value;return n==""?"":function(t){var i=new Date(Date.parse(n)),r=new Date(Date.parse(t));return i<=r}};r._filter=function(){var n=this.value;return n==""?"":function(t){var i=new Date(Date.parse(n)),r=new Date(Date.parse(t));return i>=r}};this._filters_ready()};dhx.Grid.prototype._sortCore=function(n,t,i,r,u){var f="sort",e;this._sst&&(u.stablesort=this.rowsCol.stablesort,f="stablesort");t.length>4&&(t=window[t]);t=="cus"?(e=this._customSorts[n],u[f](function(n,t){return e(r[n.idd],r[t.idd],i,n.idd,t.idd)})):typeof t=="function"?u[f](function(n,u){return t(r[n.idd],r[u.idd],i,n.idd,u.idd)}):t=="str"?u[f](function(n,t){var u=r[n.idd].toString().toLowerCase(),f=r[t.idd].toString().toLowerCase();return i=="asc"?u>f?1:u<f?-1:0:u<f?1:u>f?-1:0}):t=="num"?u[f](function(n,t){var f=parseFloat(r[n.idd]),u;return f=isNaN(f)?-99999999999999:f,u=parseFloat(r[t.idd]),u=isNaN(u)?-99999999999999:u,i=="asc"?f-u:u-f}):t=="date"&&u[f](function(n,t){var u=Date.parse(r[n.idd])||Date.parse("01/01/1900"),f=Date.parse(r[t.idd])||Date.parse("01/01/1900");return i=="asc"?u-f:f-u})};dhx.Grid.prototype.getChildElement=function(n,t){for(var i=0;i<n.childNodes.length;i++)if(n.childNodes[i].id==t)return n.childNodes[i];return null};dhx.Grid.prototype._in_header_formatted_numeric_filter=function(n,t){this._in_header_html_filter.call(this,n,t);n.firstChild._filter=function(){var n=this.value,r,i="==",t=parseFloat(n.replace("=","")),u=null;return n?n.indexOf("..")!=-1?(n=n.split(".."),t=parseFloat(n[0]),u=parseFloat(n[1]),function(n){return n=stripNonNumeric(n),n>=t&&n<=u?!0:!1}):((r=n.match(/>=|<=|>|</))&&(i=r[0],t=parseFloat(n.replace(i,""))),Function("v"," if (stripNonNumeric(v) "+i+" "+t+" ) return true; return false;")):""}};Sitka.Grid={CellEditStage:{BeforeStart:0,EditorOpened:1,EditorClosed:2}};Sitka.Grid.Class={GridColumn:function(n,t,i,r,u,f,e,o){this.columnName=n;this.title=t;this.width=i;this.align=r;this.type=u;this.sorting=f;this.filtertype=e;this.formatType=o},Grid:function(n,t,i,r,u,f,e){if(arguments.length!=7)throw new Error("Expects exactly 7 arguments Sitka.Grid.Grid constructor but got "+arguments.length);if(Sitka.Methods.isUndefinedNullOrEmpty(n))throw new Error("Required parameter gridName invalid. Must be unique to a particular grid on particular page.");if(t===undefined||t===null)throw new Error("Required parameter gridElement not provided Sitka.Grid.Grid constructor.");if(i===undefined)throw new Error("Required parameter dataElement not provided Sitka.Grid.Grid constructor.");if(r===undefined||r===null)throw new Error("Required parameter scrollPosition not provided Sitka.Grid.Grid constructor.");if(u===undefined||u===null)throw new Error("Required parameter skin not provided Sitka.Grid.Grid constructor.");if(f===undefined||f===null)throw new Error("Required parameter skinRowHeight not provided Sitka.Grid.Grid constructor.");if(this.gridName=n,this.uniqueGridName="dhtml"+n,this.gridElement=t,this.dataElement=null,this.filterCountElement=null,this.filterDownloadElement=null,this.saveGridSettingsUrl=e,i&&(this.dataElement=jQuery(i),!this.dataElement))throw new Error("Could not locate DOM element "+i);this.skin=u;this.awaitedRowHeight=f;this._columns=[];this.grid=null;if(this.grid=new dhx.Grid(this.gridElement,{headerRowHeight:50}),this.grid.SitkaGridContainer=this,this.attachedStatReady=!1,this.SCROLL_TO_FIRST="scrollToFirst",this.SCROLL_TO_LAST="scrollToLast",this.scrollPosition=r,this.scrollPosition!=this.SCROLL_TO_FIRST&&this.scrollPosition!=this.SCROLL_TO_LAST)throw new Error("Unknown scrollPosition "+r);this.footerFormatters=[]}};Sitka.Grid.Class.Grid.prototype.setGridColumns=function(n){this._columns=_(n)};Sitka.Grid.Class.Grid.prototype.getColumnIndexByName=function(n){return this._columns.pluck("columnName").indexOf(n)};Sitka.Grid.Class.Grid.prototype.htmlFilter=function(n,t){dhx.Grid.prototype._in_header_text_filter.call(this,n,t);n.firstChild._filter=function(){return function(t){var r=n.firstChild.value,u=t.toString().replace(/<[^>]*>/g,""),i=u.toLowerCase().indexOf(r.toLowerCase())!=-1;return i||(i=u.replace(/-/g,"").indexOf(r.replace(/-/g,""))!=-1),i}}};Sitka.Grid.Class.Grid.prototype.formattedNumericFilter=function(n){var t=n};Sitka.Grid.Class.Grid.prototype.getValuesFromCheckedGridRows=function(n,t,i){var r=this.grid.getCheckedRows(n),u=this,e=Sitka.Methods.isUndefinedNullOrEmpty(r)?[]:_.map(r.split(","),function(n){return u.grid.cells(n,u.getColumnIndexByName(t)).getValue()}),f={};return f[i]=e,f};var sitkaGridFilterSelectpickerOptions={container:"body",width:"100%",noneSelectedText:"",actionsBox:!0,selectedTextFormat:"count > 1"},sitkaGridOriginalLoadSelectOptions=dhx.Grid.prototype._loadSelectOptins,sitkaGridLocallyDefinedMultiSelectLoadOptions=function(n,t){sitkaGridOriginalLoadSelectOptions.call(this,n,t);var i=jQuery(n);i.find("option[value='']").remove();i.selectpicker(sitkaGridFilterSelectpickerOptions).selectpicker("refresh")};dhx.Grid.prototype._loadSelectOptins=sitkaGridLocallyDefinedMultiSelectLoadOptions;Sitka.Grid.Class.Grid.prototype.strictHtmlFilter=function(n,t){dhx.Grid.prototype._in_header_select_filter_strict.call(this,n,t);this.collectValues=function(n){var s=this.callEvent("onCollectValues",[n]),u,f,r,e,t,i,h,c,o;if(s!==!0)return s;if(this.isTreeGrid())return this.collectTreeValues(n);for(this.dma(!0),n=this._m_order?this._m_order[n]:n,u={},f=[],this._build_m_order(),r=this._f_rowsBuffer||this.rowsBuffer,e=this.hdr.grid.SitkaGridContainer._columns.value()[n],t=0;t<r.length;t++)i=this._get_cell_value(r[t],n),h=i.indexOf("<select")>-1,typeof i=="string"&&typeof e.filtertype!="undefined"&&e.filtertype=="#select_filter_html_strict"&&(h?(c=jQuery(i).children("option"),c.each(function(){var i=jQuery(this).text();i&&(!r[t]._childIndexes||r[t]._childIndexes[n]!=r[t]._childIndexes[n-1])&&(u[decodeHtml(i)]=!0)}),i=jQuery(i).children("option:selected").text()):i=i.toString().replace(/<[^>]*>/g,"")),i&&(!r[t]._childIndexes||r[t]._childIndexes[n]!=r[t]._childIndexes[n-1])&&(u[decodeHtml(i)]=!0);this.dma(!1);o=this.combos[n];for(d in u)u[d]===!0&&f.push(o?o.get(d)||d:d);return f.sort()};var i=jQuery(n),r=i.find("select.dhtmlx-grid-bootstrap-multiselect-filter"),u=i.find("select.dhtmlx-grid-bootstrap-multiselect-filter").get()[0];u._filter=function(){return function(n){function f(n){return n.toString().toLowerCase()===t.toString().toLowerCase()}var i=r.val(),t,u;return i==null?!0:(t=decodeHtml(n.toString().replace(/<[^>]*>/g,"")),u=n.indexOf("<select")>-1,u&&(t=jQuery(n).children("option:selected").text()),i.some(f))}}};sitkaGridLocallyDefinedMultiSelectFilter=function(n,t){var i,u,f,o,e,r;n.innerHTML="<select style='width:90%; font-size:8pt; font-family:Tahoma;' class='dhtmlx-grid-bootstrap-multiselect-filter' multiple='multiple'><\/select>";i=jQuery(n);i.addClass("dhtmlx-grid-bootstrap-multiselect-filter-container");u=i.find(".dhtmlx-grid-bootstrap-multiselect-filter");u.selectpicker(sitkaGridFilterSelectpickerOptions);i.click(function(n){return n.preventDefault(),n.stopPropagation(),!1});f=jQuery(n).find("select").get()[0];this.makeFilter(f,t);o=this.combos;f._filter=function(){return function(n){function i(t){return t.toString().toLowerCase()===n.toString().toLowerCase()}var t=u.val();return t==null?!0:t.some(i)}};this._filters_ready();e=!0;r=i.find("button.dropdown-toggle");r.css("padding","2px");r.click(function(n){n.stopPropagation();e&&r.dropdown("toggle");e=!1})};dhx.Grid.prototype._in_header_select_filter_strict=sitkaGridLocallyDefinedMultiSelectFilter;dhx.Grid.prototype._in_header_select_filter=sitkaGridLocallyDefinedMultiSelectFilter;Sitka.Grid.Class.Grid.prototype.textWithDashesFilter=function(n,t){dhx.Grid.prototype._in_header_text_filter.call(this,n,t);n.firstChild._filter=function(){return function(t){var r=n.firstChild.value,u=t.toString(),i=u.toLowerCase().indexOf(r.toLowerCase())!=-1;return i||(i=u.replace(/-/g,"").indexOf(r.replace(/-/g,""))!=-1),i}}};Sitka.Grid.Class.Grid.prototype.sortOnOtherColumn=function(n,t){this.grid.attachEvent("onBeforeSorting",function(i,r,u){return i==n?(this.sortRows(t,null,u),this.setSortImgState(!0,i,u),!1):!0})};Sitka.Grid.Class.Grid.prototype.filterOnOtherColumn=function(n,t){this.grid.attachEvent("onFilterStart",function(i,r){var f=jQuery.inArray(n,i),u;if(f!=-1){for(u=0;u<i.length;++u)this.filterBy(i[u]==n?t:i[u],r[u],u==0?!1:!0);return this.callEvent("onFilterEnd",[]),!1}return!0})};Sitka.Grid.Class.Grid.prototype.showHideFilterRow=function(n){var f="#"+this.gridElement+" div.xhdr",e="#"+this.gridElement+" div.objbox",t=jQuery(f),i=jQuery(e),r=this.grid.hdr.rows[2],u=r.style.display=="none"?0:1;n==undefined&&(n=!u);u!=n&&(u?(this.clearGridFilters(),r.style.display="none",t.height(t.height()-this.awaitedRowHeight),i.height(i.height()+this.awaitedRowHeight)):(r.style.display=navigator.userAgent.indexOf("MSIE 7.0")>=0?"inline":"table-row",t.height(t.height()+this.awaitedRowHeight),i.height(i.height()-this.awaitedRowHeight)))};Sitka.Grid.Class.Grid.prototype.showHideFilterInstructions=function(){var t="#"+this.gridElement+"filterBox",n=jQuery(t);n.is(":visible")?n.hide():n.show()};Sitka.Grid.Class.Grid.prototype.setColumnNumberFormats=function(n,t,i){for(var r,u=0;(r=n.indexOf(t,u))>-1;)this.grid.setNumberFormat(i,r,".",","),u=r+1};Sitka.Grid.Class.Grid.prototype.buildWithArguments=function(n,t,i,r){var f,e;this.dataUrl=r;r==null&&this.grid.startFastOperations();var o=this._columns.pluck("title").value(),u=this.gridElement,s=function(){jQuery("#"+u).css("cursor","wait");var n="#"+u+" input";return jQuery(n).each(function(n,t){jQuery(t).attr("disabled","disabled")}),!0},h=function(){jQuery("#"+u).css("cursor","default");var n="#"+u+" input";return jQuery(n).each(function(n,t){jQuery(t).removeAttr("disabled")}),!0},c=function(){jQuery("#"+u).find(".dhtmlx-grid-bootstrap-multiselect-filter-container").find(".btn-group.open .dropdown-toggle").dropdown("toggle")};return this.dataElement?typeof this.dataElement.html=="function"?this.grid.parse(this.dataElement.html().replace(/&nbsp;/g," ")):this.grid.parse(this.dataElement.replace(/&nbsp;/g," ")):r&&this.load(r),r==null&&this.grid.stopFastOperations(),this.scrollPosition==this.SCROLL_TO_LAST&&(f=this.grid.getRowsNum()-1,f>=0&&(e=this.grid.getRowId(f),this.grid.showRow(e))),this.grid};Sitka.Grid.Class.Grid.prototype.buildWithDataUrl=function(n,t,i){this.buildWithArguments(n,t,null,i)};Sitka.Grid.Class.Grid.prototype.load=function(n){this.grid.data.load(n)};Sitka.Grid.Class.Grid.prototype.setGridInstructions=function(n,t){var i=jQuery(this.grid.objBox);i.append(n).addClass("gridInstruction");t?this.showGridInstructions():this.hideGridInstructions()};Sitka.Grid.Class.Grid.prototype.showGridInstructions=function(){var n=jQuery(this.grid.objBox);jQuery(".gridInstruction",n).show();n.addClass("gridInstructionPane")};Sitka.Grid.Class.Grid.prototype.hideGridInstructions=function(){var n=jQuery(this.grid.objBox);jQuery(".gridInstruction",n).hide();n.removeClass("gridInstructionPane")};Sitka.Grid.Class.Grid.prototype.build=function(n,t,i){this.buildWithArguments(n,t,i,null)};Sitka.Grid.Class.Grid.prototype.formatEdit=function(n,t){this.grid.rowsAr[n].cells[t].className+=" sitkaGridEditable"};Sitka.Grid.Class.Grid.prototype.getFilterValuesFromGrid=function(){for(var t=[],n=0;n<this.grid.getColumnsNum();n++)t[n]=this.grid.getFilterElement(n)!==null?this.grid.getFilterElement(n).value:null;return t};Sitka.Grid.Class.Grid.prototype.hasSavedFilters=function(){var n=this.getFilterValuesFromGrid(),t=n.join(""),i=jQuery.trim(t);return i.length>0};Sitka.Grid.Class.Grid.prototype.setFilteringButtonTagName=function(n){this.filterTagName="#"+n};Sitka.Grid.Class.Grid.prototype.showOrHideFilteringButton=function(){this.filterTagName&&(this.hasSavedFilters()?jQuery(this.filterTagName).show():jQuery(this.filterTagName).hide())};Sitka.Grid.Class.Grid.prototype.resetMultiSelectFilters=function(){var n=this.grid.multiSelectFilters;n!=undefined&&jQuery.each(n,function(n,t){t.toggleAllLabelsAndCheckboxes(!0,!0);t.updateSelectTitle();jQuery.each(jQuery(t.selectElem).find("option"),function(n,t){jQuery(t).attr("selected","selected")})})};Sitka.Grid.Class.Grid.prototype.clearGridFilters=function(){var n,t;if(this.grid.filters){for(n=0;n<this.grid.filters.length;n++)t=this.grid.filters[n],t&&(t[0].value="");this.grid.refreshFilters();this.resetMultiSelectFilters();this.grid.filterBy(0,"");this.saveFiltersToServer();this.showOrHideFilteringButton();this.updateFilterCountElement();this.updateFilterDownloadElement();this.grid.callEvent("onFilterEnd",[])}};Sitka.Grid.Class.Grid.prototype.setGridFromSavedValues=function(n){this.grid.refreshFilters();for(var t=0;t<n.length;t++){if(t>this.grid.getColumnsNum())break;n[t]!==null&&this.grid.getFilterElement(t)!==null&&(this.grid.getFilterElement(t).value=n[t])}this.grid.filterByAll();this.showOrHideFilteringButton()};Sitka.Grid.Class.Grid.prototype.setupFilterCountElement=function(n){var t=this;this.filterCountElement=jQuery("#"+n)};Sitka.Grid.Class.Grid.prototype.setupFilterDownloadElement=function(n){var t=this;this.filterDownloadElement=jQuery("#"+n);this.filterDownloadElement.parent().show()};Sitka.Grid.Class.Grid.prototype.updateFilterCountElement=function(){this.filterCountElement&&this.filterCountElement.html(this.grid.getRowsNum())};Sitka.Grid.Class.Grid.prototype.updateSelectedCheckboxCount=_.debounce(function(){var n=jQuery("#"+this.gridName+"MetaDivID .checked-checkboxes"),r=jQuery("#"+this.gridName+"MetaDivID span#"+this.gridName+"CheckedCheckboxCount");if(this.grid.getColType(0)==="ch"){var t=this.grid.getCheckedRows(0),u=t.split(","),f=u.length,i=t===""?0:f;r.html(i);i>0?n.show():n.hide()}},200);Sitka.Grid.Class.Grid.prototype.updateFilterDownloadElement=function(){if(this.filterDownloadElement){var n="all rows",t=this.grid.getRowsNum();t!=this.unfilteredRowCount&&(n=t+" rows");this.filterDownloadElement.html(n)}};Sitka.Grid.Class.Grid.prototype.retrieveValuesFromColumn=function(n){var e=this.getColumnIndexByName(n),r,o,t,u,f,i;if(typeof e=="undefined")return alert(n+" column not defined, so cannot email Persons. Please contact support@sitkatech.com for assistance."),"";for(r=[],o=this.grid.getRowsNum(),t=0;t<o;t++)if(u=this.grid.cellByIndex(t,e).getValue(),!Sitka.Methods.isUndefinedNullOrEmpty(u))for(f=u.split(","),i=0;i<f.length;++i)r.push(parseInt(f[i]));return _.uniq(r)};Sitka.Grid.Class.Grid.prototype.resizeGridWithVerticalFill=function(){var n=jQuery("#"+this.gridElement),i=n.offset().top,r=i+50,u=jQuery(window).height(),t=u-r;t=Math.max(t,300);jQuery("#"+this.gridName+"MetaDivID").width(n.width())};Sitka.Grid.Class.Grid.prototype.resizeGridWidths=function(){var n=jQuery("#"+this.gridElement),t=n.parent();this.grid.enableAutoWidth(!0,t.width(),100);this.grid.setSizes();jQuery("#"+this.gridName+"MetaDivID").width(n.width())};Sitka.Grid.Class.Grid.prototype.setupServerFilterSaving=function(){var n=this};Sitka.Grid.Class.Grid.prototype.getColumnSortTypeByIndex=function(n){return this._columns.pluck("sorting").value()[n]};Sitka.Grid.Class.Grid.prototype.asGridTableForSettings=function(){var n=this.SortInfo,i=new GridTable.GridTable(this.gridName),t=this;return t._columns.forEach(function(r){var o=r.columnName,u=t.getColumnIndexByName(o),a=t.grid.getColWidth(u),s=[],e=t.grid.getFilterElement(u),f;e!==null&&typeof e!="undefined"&&(f=jQuery(e).val(),s=f instanceof Array?f:[f]);var h=null,c=null,l=null;n!=null&&n!==undefined&&u===n.Index&&(h=!0,c=n.Direction,l=n.Type);i.addColumn(o,s,a,u,h,c,l)}).value(),i};Sitka.Grid.Class.Grid.prototype.sitkaGridToExcel=function(n){var t=this;this.saveFiltersToServer(this.grid.toExcel(n))};Sitka.Grid.Class.Grid.prototype.saveFiltersToServer=function(n){var t=this.asGridTableForSettings();SitkaAjax.post(this.saveGridSettingsUrl,{Data:JSON.stringify(t)},n,function(){})};